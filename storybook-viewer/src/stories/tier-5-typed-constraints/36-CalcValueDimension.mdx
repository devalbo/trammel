import { Meta } from '@storybook/blocks';

<Meta title="Tier 5 — Typed Constraints/36 CalcValue Dimension" />

# 024 — CalcValue Dimension

<div style={{
  padding: '12px 16px',
  marginBottom: 24,
  background: '#fff8e1',
  border: '1px solid #ffe082',
  borderRadius: 4,
  fontSize: 14,
  color: '#6d4c00',
}}>
  **Spec only** — this component is not yet implemented. The syntax below shows the target API.
</div>

## Description

A rect whose width is computed from a function that reads another shape's resolved geometry via the solver context.

## Elements

| Element | Type | Purpose |
|---------|------|---------|
| `<Rect>` #source | Primitive | Reference shape |
| `<Rect>` #derived | Primitive | Width computed by CalcValue |

## Syntax

```jsx
<Sprite viewBox="0 0 300 120">
  <Rect id="source" x={10} y={20} width={120} height={60} fill="#4a90d9" />

  <Rect
    id="derived"
    left="#source.right + 20"
    top="#source.top"
    dim={{
      type: 'calc',
      w: (ctx) => ctx.get('source').w * 0.5 + 10,
      h: (ctx) => ctx.get('source').h
    }}
    fill="#2ecc71"
  />
</Sprite>
```

## Resolver Trace

1. source: `\{ x: 10, y: 20, w: 120, h: 60 \}`
2. derived width: `ctx.get('source').w * 0.5 + 10` = `120 * 0.5 + 10` = 70
3. derived height: `ctx.get('source').h` = 60
4. derived left: `#source.right + 20` = 130 + 20 = 150

## Expected SVG Output

```svg
<svg viewBox="0 0 300 120" xmlns="http://www.w3.org/2000/svg">
  <rect x="10" y="20" width="120" height="60" fill="#4a90d9" />
  <rect x="150" y="20" width="70" height="60" fill="#2ecc71" />
</svg>
```

## What This Validates

- CalcValue functions receive SolverContext and can read other shapes
- `ctx.get(id)` returns the resolved BoundingBox of another shape
- CalcValue can express arbitrary arithmetic not possible in reference strings
